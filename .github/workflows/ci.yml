# CI Workflow for CV Generator
# Runs on push/pull_request to validate CV data and prevent regressions

name: CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install jinja2

      - name: Verify locked files integrity
        run: |
          echo "Verifying locked JSON files are unchanged..."
          echo "1ee82702bd82b8a46c8fd907f9c691ab124671350a8769f5d98adbfc5925e7b1  data/cvs/ramin.json" | sha256sum -c -
          echo "e83738f284a565811a8eca795a91f094faa81873ede61221d57e4db0d131e85d  data/cvs/mahsa.json" | sha256sum -c -
          echo "âœ… Locked files verified"

      - name: Run smoke validation
        run: |
          python scripts/smoke_validate.py --all

      - name: Test CV generation (dry run)
        run: |
          python scripts/test_cv_generation.py

      - name: Upload validation results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: validation-results
          path: |
            validation-report.json
            docs/visual-proof/
          retention-days: 7
