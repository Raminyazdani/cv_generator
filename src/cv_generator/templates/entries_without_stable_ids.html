{% extends "base.html" %}

{% block title %}Entries Without Stable IDs{% endblock %}

{% block content %}
<nav class="breadcrumb">
    <a href="{{ url_for('index') }}">Home</a> &raquo;
    <a href="{{ url_for('diagnostics') }}">Diagnostics</a> &raquo;
    Entries Without Stable IDs
</nav>

<h2>‚ö†Ô∏è Entries Without Stable IDs</h2>
<p style="color: var(--gray-600); margin-bottom: 1rem;">
    These {{ total_count }} entries were imported before the multilingual linking system was introduced.
    They cannot be linked to their language counterparts until they have stable IDs assigned.
</p>

<style>
.section-group {
    margin-bottom: 1.5rem;
}

.section-header {
    background: var(--gray-100);
    padding: 0.75rem 1rem;
    border-radius: 8px 8px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 500;
}

.section-entries {
    border: 1px solid var(--gray-200);
    border-top: none;
    border-radius: 0 0 8px 8px;
    background: white;
}

.entry-row {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--gray-100);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
}

.entry-row:last-child {
    border-bottom: none;
}

.entry-info {
    flex: 1;
}

.entry-summary {
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.entry-meta {
    font-size: 0.8rem;
    color: var(--gray-500);
}

.entry-actions {
    display: flex;
    gap: 0.5rem;
    flex-shrink: 0;
}

.bulk-actions {
    background: var(--gray-100);
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.count-badge {
    background: var(--warning);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.85rem;
    font-weight: 500;
}

.no-entries {
    text-align: center;
    padding: 3rem;
    color: var(--gray-500);
}

.no-entries .icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}
</style>

{% if total_count > 0 %}
<div class="bulk-actions">
    <div>
        <span class="count-badge">{{ total_count }} entries</span>
        <span style="margin-left: 0.5rem; color: var(--gray-600);">need stable ID assignment</span>
    </div>
    <form action="{{ url_for('auto_assign_stable_ids_route') }}" method="post" style="display: inline;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="btn btn-primary" 
                onclick="return confirm('This will assign a unique stable ID to each entry. Continue?')">
            üîß Auto-Assign Stable IDs to All
        </button>
    </form>
</div>

{% for section, section_entries in entries_by_section.items() %}
<div class="section-group">
    <div class="section-header">
        <span>{{ get_section_label(section) }} ({{ section }})</span>
        <span class="count-badge" style="background: var(--primary);">{{ section_entries | length }}</span>
    </div>
    <div class="section-entries">
        {% for entry in section_entries %}
        <div class="entry-row">
            <div class="entry-info">
                <div class="entry-summary">{{ entry.summary }}</div>
                <div class="entry-meta">
                    Person: {{ entry.person_slug }} | Entry ID: {{ entry.id }} | Order: {{ entry.order_idx }}
                    {% if entry.tags %}
                    | Tags: {{ entry.tags | join(', ') }}
                    {% endif %}
                </div>
            </div>
            <div class="entry-actions">
                <form action="{{ url_for('assign_stable_id_route', entry_id=entry.id) }}" method="post" style="display: inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-sm btn-primary" title="Assign a new stable ID to this entry">
                        üîñ Assign ID
                    </button>
                </form>
                <a href="{{ url_for('link_entries_route', entry_id=entry.id) }}" class="btn btn-sm btn-secondary" title="Link with entries from other languages">
                    üîó Link
                </a>
                <a href="{{ url_for('entry_detail', entry_id=entry.id) }}" class="btn btn-sm btn-secondary" title="View entry details">
                    üëÅÔ∏è View
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endfor %}

{% else %}
<div class="card no-entries">
    <div class="icon">‚úÖ</div>
    <h3 style="margin-bottom: 0.5rem;">All Entries Have Stable IDs</h3>
    <p>No entries require stable ID assignment. All entries can be linked and grouped across languages.</p>
</div>
{% endif %}

<div class="card" style="margin-top: 1.5rem;">
    <h3 style="margin-bottom: 1rem;">‚ÑπÔ∏è About Stable IDs</h3>
    <ul style="color: var(--gray-600); line-height: 1.8;">
        <li><strong>Stable IDs</strong> are unique identifiers that link entries across languages (EN/DE/FA).</li>
        <li>Entries with the same stable ID are treated as translations of each other.</li>
        <li><strong>Assign ID</strong> creates a new stable ID for a single entry.</li>
        <li><strong>Link</strong> allows you to manually connect entries from different languages together.</li>
        <li><strong>Auto-Assign</strong> gives each entry its own stable ID (use Link to connect them afterwards).</li>
    </ul>
</div>

<div class="actions" style="margin-top: 1rem;">
    <a href="{{ url_for('diagnostics') }}" class="btn btn-secondary">‚Üê Back to Diagnostics</a>
</div>
{% endblock %}
