{% extends "base.html" %}

{% block title %}Edit Entry Tags{% endblock %}

{% block content %}
<nav class="breadcrumb">
    <a href="{{ url_for('index') }}">Home</a> &raquo;
    <a href="{{ url_for('person_dashboard', person=entry.person_slug) }}">{{ entry.person_slug }}</a> &raquo;
    <a href="{{ url_for('section_entries', person=entry.person_slug, section=entry.section) }}">{{ entry.section | replace('_', ' ') | title }}</a> &raquo;
    Entry
</nav>

<h2>{{ entry.summary }}</h2>

{% if entry.section in ['projects', 'experiences', 'publications', 'references', 'education', 'languages', 'profiles', 'workshop_and_certifications'] %}
<div style="margin-bottom: 1rem; display: flex; gap: 0.5rem;">
    <a href="{{ url_for('edit_entry_route', entry_id=entry.id) }}" class="btn btn-primary">‚úèÔ∏è Edit Entry</a>
    <a href="{{ url_for('entry_linked_route', entry_id=entry.id) }}" class="btn btn-secondary">üåê View Linked Languages</a>
</div>
{% endif %}

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h3>Assign Tags</h3>
        <div class="language-selector">
            <span style="color: var(--gray-500); font-size: 0.85rem;">Language: </span>
            {% for lang in supported_languages %}
            <a href="{{ url_for('set_language', lang=lang) }}" 
               class="btn btn-sm {% if current_language == lang %}btn-primary{% else %}btn-secondary{% endif %}">
                {{ lang | upper }}
            </a>
            {% endfor %}
        </div>
    </div>
    
    <form action="{{ url_for('update_entry_tags_route', entry_id=entry.id) }}" method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <div class="form-group">
            <div class="checkbox-list">
                {% if all_tags %}
                    {% for tag in all_tags %}
                    <label class="checkbox-item">
                        <input type="checkbox" name="tags" value="{{ tag.name }}"
                            {% if tag.name in entry.tags %}checked{% endif %}>
                        {{ tag.display_label }}
                        {% if tag.display_label != tag.name and current_language != 'en' %}
                        <span style="color: var(--gray-400); font-size: 0.8rem;">({{ tag.name }})</span>
                        {% endif %}
                        {% if not tag.has_translation and current_language != 'en' %}
                        <span class="tag" style="background: var(--warning); font-size: 0.65rem; margin-left: 0.25rem;">no translation</span>
                        {% endif %}
                        <span class="tag tag-count" style="margin-left: auto;">{{ tag.usage_count }}</span>
                    </label>
                    {% endfor %}
                {% else %}
                    <p style="padding: 1rem; color: var(--gray-500);">
                        No tags exist yet. <a href="{{ url_for('create_tag_route') }}">Create one</a>
                    </p>
                {% endif %}
            </div>
        </div>
        
        <div class="actions">
            <button type="submit" class="btn btn-primary">üíæ Save Tags</button>
            <a href="{{ url_for('create_tag_route') }}" class="btn btn-secondary">+ New Tag</a>
        </div>
    </form>
</div>

<div class="card" style="margin-top: 1rem;">
    <h3 style="margin-bottom: 1rem;">Entry Data (Read-Only)</h3>
    <details>
        <summary style="cursor: pointer; color: var(--primary);">Show JSON</summary>
        <pre class="json-preview" style="margin-top: 1rem;">{{ data_json }}</pre>
    </details>
</div>
{% endblock %}
