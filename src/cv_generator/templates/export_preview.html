{% extends "base.html" %}

{% block title %}Export Preview - {{ resume_key }} ({{ language | upper }}){% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{{ url_for('index') }}">Home</a> &rsaquo;
    <a href="{{ url_for('export_page') }}">Export</a> &rsaquo;
    Preview
</div>

<h2>üìÑ Export Preview: {{ resume_key }}</h2>

<div class="card" style="margin-bottom: 1rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <strong>Resume Key:</strong> {{ resume_key }}
            <span class="tag tag-count" style="margin-left: 0.5rem;">{{ language | upper }}</span>
        </div>
        <div class="actions">
            {% for lang in supported_languages %}
                {% if lang != language %}
                    <form action="{{ url_for('export_preview_v2') }}" method="post" style="display: inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="person" value="{{ resume_key }}">
                        <input type="hidden" name="language" value="{{ lang }}">
                        <button type="submit" class="btn btn-sm btn-secondary">
                            View {{ lang | upper }}
                        </button>
                    </form>
                {% endif %}
            {% endfor %}
            <form action="{{ url_for('export_single') }}" method="post" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="hidden" name="person" value="{{ resume_key }}">
                <input type="hidden" name="language" value="{{ language }}">
                <button type="submit" class="btn btn-success">
                    üíæ Export to File
                </button>
            </form>
        </div>
    </div>
</div>

<div class="card">
    <h3>JSON Preview</h3>
    <p class="entry-meta" style="margin-bottom: 1rem;">
        This is what will be exported. The preview is generated from the v2 database using the lossless export engine.
    </p>
    <pre class="json-preview" style="max-height: 600px;">{{ json_preview }}</pre>
</div>

{% if cv_data %}
<div class="card" style="margin-top: 1rem;">
    <h3>üìä Summary</h3>

    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        {% if cv_data.config %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Config</span>
            <div>ID: <strong>{{ cv_data.config.ID }}</strong></div>
            <div>Lang: <strong>{{ cv_data.config.lang | upper }}</strong></div>
        </div>
        {% endif %}

        {% if cv_data.basics and cv_data.basics|length > 0 %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Basics</span>
            <div><strong>{{ cv_data.basics[0].fname }} {{ cv_data.basics[0].lname }}</strong></div>
            {% if cv_data.basics[0].email %}
            <div class="entry-meta">{{ cv_data.basics[0].email }}</div>
            {% endif %}
        </div>
        {% endif %}

        {% if cv_data.education %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Education</span>
            <div><strong>{{ cv_data.education | length }}</strong> entries</div>
        </div>
        {% endif %}

        {% if cv_data.experiences %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Experiences</span>
            <div><strong>{{ cv_data.experiences | length }}</strong> entries</div>
        </div>
        {% endif %}

        {% if cv_data.projects %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Projects</span>
            <div><strong>{{ cv_data.projects | length }}</strong> entries</div>
        </div>
        {% endif %}

        {% if cv_data.publications %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Publications</span>
            <div><strong>{{ cv_data.publications | length }}</strong> entries</div>
        </div>
        {% endif %}

        {% if cv_data.skills %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Skills</span>
            <div><strong>{{ cv_data.skills | length }}</strong> categories</div>
        </div>
        {% endif %}

        {% if cv_data.languages %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Languages</span>
            <div><strong>{{ cv_data.languages | length }}</strong> entries</div>
        </div>
        {% endif %}

        {% if cv_data.references %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">References</span>
            <div><strong>{{ cv_data.references | length }}</strong> entries</div>
        </div>
        {% endif %}

        {% if cv_data.profiles %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Profiles</span>
            <div><strong>{{ cv_data.profiles | length }}</strong> entries</div>
        </div>
        {% endif %}

        {% if cv_data.workshop_and_certifications %}
        <div class="health-check-item" style="display: block; padding: 1rem; background: var(--gray-50); border-radius: 4px;">
            <span class="entry-meta">Certifications</span>
            <div><strong>{{ cv_data.workshop_and_certifications | length }}</strong> issuer groups</div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<div class="card" style="margin-top: 1rem;">
    <div class="actions">
        <a href="{{ url_for('export_page') }}" class="btn btn-secondary">‚Üê Back to Export</a>
    </div>
</div>
{% endblock %}
