{% extends "base.html" %}

{% block title %}Tags{% endblock %}

{% block content %}
<h2>Tags</h2>

<div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
    <a href="{{ url_for('create_tag_route') }}" class="btn btn-primary">+ Create Tag</a>
    
    <div class="language-selector">
        <span style="color: var(--gray-500); font-size: 0.9rem;">Display language: </span>
        {% for lang in supported_languages %}
        <a href="{{ url_for('set_language', lang=lang) }}" 
           class="btn btn-sm {% if current_language == lang %}btn-primary{% else %}btn-secondary{% endif %}"
           style="margin-left: 0.25rem;">
            {{ lang | upper }}
        </a>
        {% endfor %}
    </div>
</div>

{% if tags %}
<div class="card">
    <div style="margin-bottom: 1rem;">
        <input type="text" id="search-input" placeholder="Search tags..." 
               style="width: 100%; padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 4px;">
    </div>
    
    <div id="tags-list">
    {% for tag in tags %}
    <div class="list-item tag-item" data-search="{{ tag.name | lower }} {{ tag.display_label | lower }} {{ tag.description | default('') | lower }}">
        <div style="flex: 1;">
            <strong>{{ tag.display_label }}</strong>
            {% if tag.display_label != tag.name and current_language != 'en' %}
            <span style="color: var(--gray-400); font-size: 0.85rem;">({{ tag.name }})</span>
            {% endif %}
            {% if not tag.has_translation and current_language != 'en' %}
            <span class="tag" style="background: var(--warning); font-size: 0.7rem;">no translation</span>
            {% endif %}
            {% if tag.description %}
            <p style="color: var(--gray-500); font-size: 0.9rem;">{{ tag.description }}</p>
            {% endif %}
        </div>
        <span class="tag tag-count">{{ tag.usage_count }} entries</span>
        <div class="actions" style="margin-left: 1rem;">
            <a href="{{ url_for('edit_tag_route', name=tag.name) }}" class="btn btn-secondary btn-sm">Edit</a>
            <form action="{{ url_for('delete_tag_route', name=tag.name) }}" method="post" 
                  onsubmit="return confirm('Delete tag &quot;{{ tag.name }}&quot;? It will be removed from all entries.');"
                  style="display: inline;">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
        </div>
    </div>
    {% endfor %}
    </div>
    
    <div id="no-results" style="display: none; text-align: center; padding: 1rem; color: var(--gray-500);">
        No tags match your search.
    </div>
</div>

<script>
document.getElementById('search-input').addEventListener('input', function() {
    const query = this.value.toLowerCase().trim();
    const tags = document.querySelectorAll('.tag-item');
    const noResults = document.getElementById('no-results');
    let visibleCount = 0;
    
    tags.forEach(function(tag) {
        const searchText = tag.getAttribute('data-search');
        if (query === '' || searchText.includes(query)) {
            tag.style.display = 'flex';
            visibleCount++;
        } else {
            tag.style.display = 'none';
        }
    });
    
    noResults.style.display = visibleCount === 0 ? 'block' : 'none';
});
</script>
{% else %}
<div class="card empty-state">
    <p>No tags created yet.</p>
    <p style="margin-top: 1rem;">
        <a href="{{ url_for('create_tag_route') }}" class="btn btn-primary">Create your first tag</a>
    </p>
</div>
{% endif %}
{% endblock %}
